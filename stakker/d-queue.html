<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js rust">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Queue execution behaviour - Stakker actor runtime guide</title>




        <!-- Custom HTML head -->



        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="A guide to the Stakker low-level actor runtime for Rust">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">

        <link rel="stylesheet" href="fonts/fonts.css">


        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->



    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "rust";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item affix "><a href="about.html">About Stakker</a></li><li class="chapter-item "><a href="faq.html"><strong aria-hidden="true">1.</strong> Stakker FAQ</a></li><li class="chapter-item expanded "><a href="d-intro.html"><strong aria-hidden="true">2.</strong> Stakker Design Notes</a><a class="toggle"><div>‚ù±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="d-origin.html"><strong aria-hidden="true">2.1.</strong> Origin</a></li><li class="chapter-item "><a href="d-addr.html"><strong aria-hidden="true">2.2.</strong> Addressing events to objects</a></li><li class="chapter-item "><a href="d-deliv.html"><strong aria-hidden="true">2.3.</strong> Delivering events</a></li><li class="chapter-item "><a href="d-actor.html"><strong aria-hidden="true">2.4.</strong> Becoming an actor system</a></li><li class="chapter-item "><a href="d-guarantee.html"><strong aria-hidden="true">2.5.</strong> Actor guarantees</a></li><li class="chapter-item "><a href="d-lowlev.html"><strong aria-hidden="true">2.6.</strong> Low-level actors</a></li><li class="chapter-item "><a href="d-fast.html"><strong aria-hidden="true">2.7.</strong> Fast message execution</a></li><li class="chapter-item expanded "><a href="d-queue.html" class="active"><strong aria-hidden="true">2.8.</strong> Queue execution behaviour</a></li><li class="chapter-item "><a href="d-time.html"><strong aria-hidden="true">2.9.</strong> Time virtualization</a></li><li class="chapter-item "><a href="d-events.html"><strong aria-hidden="true">2.10.</strong> Event source independence</a></li><li class="chapter-item "><a href="d-single.html"><strong aria-hidden="true">2.11.</strong> Single-threaded performance</a></li><li class="chapter-item "><a href="d-whysing.html"><strong aria-hidden="true">2.12.</strong> Why single-threaded?</a></li><li class="chapter-item "><a href="d-timers.html"><strong aria-hidden="true">2.13.</strong> Timer queue</a></li><li class="chapter-item "><a href="d-defer.html"><strong aria-hidden="true">2.14.</strong> Deferrer</a></li><li class="chapter-item "><a href="d-prep.html"><strong aria-hidden="true">2.15.</strong> Actor Prep state</a></li><li class="chapter-item "><a href="d-sig.html"><strong aria-hidden="true">2.16.</strong> Signatures of actor methods</a></li><li class="chapter-item "><a href="d-sigalt.html"><strong aria-hidden="true">2.17.</strong> Alternative signatures</a></li><li class="chapter-item "><a href="d-data.html"><strong aria-hidden="true">2.18.</strong> Data kept with actor state</a></li><li class="chapter-item "><a href="d-overh.html"><strong aria-hidden="true">2.19.</strong> Overhead of an actor</a></li><li class="chapter-item "><a href="d-retfwd.html"><strong aria-hidden="true">2.20.</strong> Ret and Fwd differences</a></li><li class="chapter-item "><a href="d-retnone.html"><strong aria-hidden="true">2.21.</strong> Detecting delivery failure</a></li><li class="chapter-item "><a href="d-term.html"><strong aria-hidden="true">2.22.</strong> Actor termination</a></li><li class="chapter-item "><a href="d-macro.html"><strong aria-hidden="true">2.23.</strong> Macro argument structure</a></li><li class="chapter-item "><a href="d-drop.html"><strong aria-hidden="true">2.24.</strong> Dropping to clean up</a></li><li class="chapter-item "><a href="d-feat.html"><strong aria-hidden="true">2.25.</strong> Cargo features and safety</a></li><li class="chapter-item "><a href="d-traits.html"><strong aria-hidden="true">2.26.</strong> Actor&lt;dyn Trait&gt;</a></li><li class="chapter-item "><a href="d-whyactor.html"><strong aria-hidden="true">2.27.</strong> Why use actors?</a></li><li class="chapter-item "><a href="d-waker.html"><strong aria-hidden="true">2.28.</strong> Inter-thread communication</a></li><li class="chapter-item "><a href="d-toplevel.html"><strong aria-hidden="true">2.29.</strong> Top-level actor template</a></li></ol></li><li class="chapter-item "><a href="roadmap.html"><strong aria-hidden="true">3.</strong> Stakker Roadmap</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">

                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>

                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>

                    </div>

                    <h1 class="menu-title">Stakker actor runtime guide</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>


                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>


                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#queue-execution-behaviour" id="queue-execution-behaviour">Queue execution behaviour</a></h1>
<p>The normal pattern is to introduce one or more events into the system
as actor calls pushed onto the main queue, and then to run the queue
to completion.  This means that the queue is run repeatedly until it
is empty.  You can imagine that a queued call to the actor may trigger
other calls as a consequence, and those might cause other calls, but
eventually all the necessary changes will finish propagating through
the system of actors, and then things will go quiet again.</p>
<p><strong>Stakker</strong> always runs the main queue to completion before doing
anything else.  This means that if you wish to avoid saturating the
CPU, it's necessary to regulate fetching input data or accepting input
events.  Load regulation does not occur within the actor system.</p>
<p>To aid with this, two additional queues are provided:</p>
<ul>
<li>
<p>The first is the &quot;lazy&quot; queue.  This is run when the main queue is
fully exhausted, but before checking for new I/O events.  As an
example, it can be used to help batch output together into a single
big flush.  For example when writing to TCP, executing the main
queue might mean several chunks of data being written to a stream's
output buffer.  Flushing after each write would be inefficient, and
flushing after a delay would be too slow.  Instead an actor can put
the flush call on the lazy queue, and do one big flush once the
current batch of processing is complete.</p>
</li>
<li>
<p>The second is the &quot;idle&quot; queue.  This is executed only when the
thread becomes idle, i.e. the main and lazy queues are empty and
there are no new external events that need handling.  This may be
used to apply back-pressure on an incoming stream, by fetching more
data only when there is nothing else to do.  When there are several
items on the idle queue, they will execute in a round-robin fashion,
assuming each call pushes a new call back onto the queue when it
executes.</p>
</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->

                            <a rel="prev" href="d-fast.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>



                            <a rel="next" href="d-time.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

                    <a rel="prev" href="d-fast.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>



                    <a rel="next" href="d-time.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>

            </nav>

        </div>








        <script type="text/javascript">
            window.playground_copyable = true;
        </script>





        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>


        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->




    </body>
</html>
